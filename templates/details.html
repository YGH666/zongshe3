<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>快发A股资讯平台</title>
{#    <script type="text/javascript" src="../static/js/rotate.js"></script>#}
    <script src="../static/script/jquery-3.3.1.min.js"></script>
    <script src="../static/script/move++.js"></script>
      <script src="../static/script/cookie.js"></script>
      <link rel="stylesheet" href="../static/layui/css/layui.css" media="all">
    <script src="../static/layui/layui.js"></script>
    <link rel="stylesheet" href="../static/styles/login.css">
    <link rel="stylesheet" href="../static/styles/index1.css">
    <link rel="stylesheet" type="text/css" href="../static/styles/search-form.css" />
    <script>
        window.onload=function () {
            var keyword = GetRequest();

            console.log(keyword);
            console.log(JSON.stringify(keyword));
            search_req(keyword);
        }

{#****************************************************************************向服务器传输关键字并获取返回数据#}
        function search_req(words) {
            $.ajax({
                type: "post",
                url: "http://148.70.200.102:11250/search",
                async: true,
                contentType: 'application/json',
                dataType: 'JSON',
                xhrFields: {withCredentials: false},
                crossDomain: true,
                data: JSON.stringify(words), //将对象转为json字符串
                success: function (data) {
                  console.log(data);
                  if (data.tag == "success") {
                    alert('查询成功');
                  }
                  else {
                      alert('无匹配数据');
                  }

                }
            });
        }

        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
</script>

<script type="text/javascript">
       function searchToggle(obj, evt){
                var container = $(obj).closest('.search-wrapper');

                if(!container.hasClass('active')){
                      container.addClass('active');
                      evt.preventDefault();
                }
                else if(container.hasClass('active') && $(obj).closest('.input-holder').length == 0){
                      container.removeClass('active');
                      // clear input
                      container.find('.search-input').val('');
                      // clear and hide result container when we press close
                      container.find('.result-container').fadeOut(100, function(){$(this).empty();});
                }
            }

       function submitFn(obj, evt){
                value = $(obj).find('.search-input').val().trim();
                if(!value.length){
                    alert("关键词不能为空!");
                }
                else{
                    var link="details"+"?keyword="+value;
                    window.location.href=link;
                    {#search_req(value);#}
                }
                evt.preventDefault();
            }
</script>
</head>

<body>
<style>
      .search_table{
          position: absolute;
          left: 50px;
          top: 120px;
          z-index: 0;
      }

      .recommend_table{
          position: absolute;
          right: 50px;
          top: 120px;
          z-index: 0;
      }

    .line{
        {#width: 800px;#}
        height: 1px;
        background: gray;
        margin-top: 5px;
    }
    .line1{
                {#width: 800px;#}
    }
    .line2{
        {#width: 200px;#}
    }
  </style>
  <div class="search_table">
      <h2>为您找到的证券:</h2>
      <div class="line line1"></div>
      <table id="search_table"  lay-filter="search_table"></table>
  </div>

  <div class="recommend_table" >
      <h2>可能会感兴趣的证券:</h2>
      <div class="line line2"></div>
      <table id="interested_table" class="layui-table" lay-skin="line" lay-filter="interested_table"></table>
  </div>

<script>
    layui.use('table', function(){
      var table = layui.table;
      table.on('row(search_table)', function(obj){
          console.log(obj.tr) //得到当前行元素对象
          console.log(obj.data['id']) //得到当前行数据
          var link="company"+"?id="+obj.data['id'];
          window.location.href=link;
          //obj.del(); //删除当前行
          //obj.update(fields) //修改当前行数据
        });
      table.on('row(interested_table)', function(obj){
          console.log(obj.tr) //得到当前行元素对象
          console.log(obj.data['id']) //得到当前行数据
          //obj.del(); //删除当前行
          //obj.update(fields) //修改当前行数据
        });
    table.render({
    elem: '#search_table',
    height: 500,
    width:1000,
    url: '/get_table', //数据接口
    page: {
        layout:['limit','count','prev','page','next','skip'],
        limit:10,
        limits:[5,10,15],
        groups:2,
        first:"首页",
        last:"尾页"
    },
    cols: [[ //表头
      {field: 'id', title: '证券代码', sort: true, fixed: 'left',width:120},
      {field: 'shortname', title: '公司简称'},
      {field: 'reg_place', title: '注册地'},
      {field: 'market_time', title: '上市时间', sort: true},
      {field: 'executive', title: '公司高管'}
    ]],
      text: {
        none: '暂无匹配数据'
      }

  });
    table.render({
        elem: '#interested_table',
        {#height: 500,#}
        url:'/get_interested_table',
        {#page:true,#}
        cols: [[ //表头
                  {field: 'id', title: '证券代码',width:120},
                  {field: 'shortname', title: '公司简称',width:120}
                ]]
    })
});
</script>

  <nav>
    <div class="menubar">
      <a href="index1" class="home"> </a>
      <div>
          <form onSubmit="submitFn(this, event);">
                <div class="search-wrapper active">
                    <div class="input-holder">
                        <input type="text" class="search-input" placeholder="请输入关键词（代码/高管/关键字..）" />
                        <button class="search-icon" onClick="searchToggle(this, event);"><span></span></button>
                    </div>
                    <span class="close" onClick="searchToggle(this, event);"></span>
                    <div class="result-container">

                    </div>
                </div>
          </form>


      </div>
      <div class="icons">
        <div class="secondary-icons">
{#          <i class="icon-second"><img src="../static/img/icon-198.svg"></i>#}
          <i class="icon-second" id="btn_showlogin"><img src="../static/img/icon-171.svg"></i>
        </div>

        <i class="icon-menu"><span></span></i>
      </div>
    </div>
    <ul class="menu">
      <li class="menu-link"><a href="#0" class="text-item">About Us</a></li>
      <li class="menu-link sub">
        <a href="#0" class="text-item">Our Members<span class="icon"></span></a>
        <ul class="submenu">
          <li class="sub-item"><a href="#0">Mr.Yang</a></li>
          <li class="sub-item"><a href="#0">Mr.He</a></li>
          <li class="sub-item"><a href="#0">Ms.Liu</a></li>
          <li class="sub-item"><a href="#0">Ms.Guo</a></li>
        </ul>
      </li>
      <li class="menu-link sub">
        <a href="#0" class="text-item">Our Services<span class="icon"></span></a>
        <ul class="submenu">
          <li class="sub-item"><a href="#0">Print Design</a></li>
          <li class="sub-item"><a href="#0">Web Design</a></li>
          <li class="sub-item"><a href="#0">Mobile App Development</a></li>
          <li class="sub-item"><a href="#0">UI Design</a></li>
        </ul>
      </li>
      <li class="menu-link sub">
          <a href="#0" class="text-item">联系我们<span class="icon"></span></a>
          <ul class="submenu">
              <li class="sub-item"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=841219366&amp;site=qq&amp;menu=yes" target="_blank" title="QQ">Mr.Yang</a></li>
              <li class="sub-item"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=591468224&amp;site=qq&amp;menu=yes" target="_blank" title="QQ">Mr.He</a></li>

          </ul>
      </li>
    </ul>
  </nav>

  <!-- 弹出登录窗口 -->
  <div class="mini_login">
    <form class="form-horizontal" id="login_form" method="POST" action="#">
      <p id="close_minilogin">X</p>
      <div class="heading">Welcome</div>
      <div class="form-group">
        <i id="uimg"></i>
        <input name="username" id="username" type="text" class="form-control" placeholder="E-mail" />
        <p class="usrerrformat err">Please enter the correct email format!</p>
        <p class="usrerrempty err">Username cannot be empty!</p>
      </div>
      <div class="form-group">
        <i id="pimg"></i>
        <input name="password" id="password" type="password" class="form-control" placeholder="Password" />
        <p class="paserr err">Password cannot be empty!</p>
      </div>
      <div class="form-group">
        <button type="button" onclick="signin()" class="btn btn-default"><i>Sign in</i></button>
        <span>Don't have an account? <a href="#" class="create_account" id="showSignup">Sign up</a></span><br>
        <span>Forget your password? <a href="#" class="create_account" id="showFindpass">Find back your
            password</a></span>
      </div>
    </form>
  </div>
  <!-- 弹出注册窗口 -->
  <div class="mini_signup">
    <form class="form-horizontal" id="signup_form" method="POST" action="#">
      <p id="close_minisignup">X</p>
      <div class="heading">Welcome</div>
      <div class="form-group">
        <i id="uimg"></i>
        <input name="username" id="username_signup" type="text" class="form-control" placeholder="E-mail" />
        <p class="usrerrformat err">Please enter the correct email format!</p>
        <p class="usrerrempty err">Username cannot be empty!</p>
      </div>
      <div class="form-group">
        <i id="pimg"></i>
        <input name="password" id="password_signup" type="password" class="form-control" placeholder="Password" />
        <p class="paserr err">Password cannot be empty!</p>
        <p class="paserr err">Password must be between 6 and 12 digits!</p>
      </div>
      <div class="form-group">
        <i id="pimg"></i>
        <input name="password" id="repassword_signup" type="password" class="form-control"
          placeholder="Confirm password" />
        <p class="repaserr err">Passwords are inconsistent!</p>
      </div>
      <div class="form-group">
        <i id="eimg"></i>
        <input name="VerificationCode" id="VerificationCode" type="text" class="form-control VC"
          placeholder="Enter Code" />
        <input type="button" value="SendCode" class="orange" onclick="sendCode()" />
        <p class="ecode err">Verification Code cannot be empty!</p>
      </div>

      <div class="form-group">
        <button type="button" class="btn btn-default" onclick="signup()"><i>Sign up</i></button>
        <span>Already have an account? <a href="#" class="create_account" id="showSignin1">Sign in</a></span>
      </div>
    </form>
  </div>
  <!-- 弹出find password窗口 -->
  <div class="mini_findpass">
    <form class="form-horizontal" id="findpass_form" method="POST" action="#">
      <p id="close_findpass">X</p>
      <div class="heading">Welcome</div>
      <div class="form-group">
        <i id="uimg"></i>
        <input name="username" id="username_findpass" type="text" class="form-control" placeholder="E-mail" />
        <p class="usrerrformat err">Please enter the correct email format!</p>
        <p class="usrerrempty err">Username cannot be empty!</p>
      </div>

      <div class="form-group">
        <i id="eimg"></i>
        <input name="VerificationCode" id="VerificationCode1" type="text" class="form-control VC"
          placeholder="Enter Code" />
        <input type="button" value="SendCode" class="orange" onclick="sendCode1()" />
        <p class="ecode err">Verification Code cannot be empty!</p>
      </div>

      <div class="form-group">
        <i id="pimg"></i>
        <input name="password" id="password_findback" type="password" class="form-control" placeholder="Password" />
        <p class="paserr err">Password cannot be empty!</p>
        <p class="paserr err">Password must be between 6 and 12 digits!</p>
      </div>
      <div class="form-group">
        <i id="pimg"></i>
        <input name="password" id="repassword_findback" type="password" class="form-control"
          placeholder="Confirm password" />
        <p class="repaserr err">Passwords are inconsistent!</p>
      </div>

      <div class="form-group">
        <button type="button" class="btn btn-default" onclick="findbackpass()"><i>Submit</i></button>
        <span>Already have an account? <a href="#" class="create_account" id="showSignin2">Sign in</a></span>
      </div>
    </form>
  </div>
  <div class="cover"></div>
    <script src="../static/script/script.js"></script>
<script type="text/javascript" src="../static/script/login.js"></script>
</body>

</html>